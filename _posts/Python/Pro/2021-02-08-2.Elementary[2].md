---
title:  "1.Elementary[2]"
excerpt: "전처리에 대해서 더 알아봅시다."
categories:
  - Py_Preprocessing
tags:
  - 전처리
last_modified_at: 2021-02-08

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true

math_use: true
---

```python
import pandas as pd
import numpy as np

from seaborn import load_dataset
diamonds=load_dataset('diamonds')
diamonds.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
  </tbody>
</table>
</div>



# 유용한 함수

## 같은지 검사


```python
# Analysis 예측값에 대한 재현성을 검사할때 유용하다. 
# df1 과 df2 에 대해서 두 pandas set 이 같은지 아닌지에 대해서 검사한다.
# 맞으면 True / 틀리면 False 를 나타낸다.
df1 = diamonds.copy()
df2 = df1
df1.equals(df2) 
```




    True



# Query

## 기본 성질

- 판다스에서 조건에 부합하는 데이터를 추출할 때에 매우 많이 사용한다.
- 장점 : loc 보다 가속성이 훨씬 좋다. , 메모리를 적게 먹는다.
- 단점 : loc 이랑 속도가 비슷~하다.
- Query 를 쓰는 이유는 메모리를 save 하기 위함이라고 생각하자. (아직까지 연산에서 메모리가 모자라는 지경까지 큰 데이터를 다룬적이 없어서 잘은 모르겠다.)
- 사실 Query 로 다 해결하려고 하지 말고, 간단한 연산 정도를 직관적으로 빠르게 해걀한다는 마음가짐으로 처리하자.


```python
from string import ascii_letters
df = pd.DataFrame(np.random.randint(50, size=(5000, 52)), columns=list(ascii_letters))
```


```python
%%timeit -n 100 -r 5 
df[df.B > 30]
```

    383 µs ± 70.3 µs per loop (mean ± std. dev. of 5 runs, 100 loops each)
    


```python
%%timeit -n 100 -r 5 
df[df.B.values > 30]
```

    234 µs ± 35.6 µs per loop (mean ± std. dev. of 5 runs, 100 loops each)
    


```python
%%timeit -n 100 -r 5 
df.query('B > 30')
```

    1.91 ms ± 119 µs per loop (mean ± std. dev. of 5 runs, 100 loops each)
    

Query 함수는 아래 6가지 기능을 포함하고 있다. 

1) 비교 연산자( ==, >, >=, <, <=, != )

2) in 연산자( in, ==, not in, != )

3) 논리 연산자(and, or, not)

4) 외부 변수(또는 함수) 참조 연산

5) 인덱스 검색

6) 문자열 부분검색( str.contains, str.startswith, str.endswith )


## 비교(> = < !) 연산


```python
df = diamonds.copy()
```


```python
df.query('x>10')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25998</th>
      <td>4.01</td>
      <td>Premium</td>
      <td>I</td>
      <td>I1</td>
      <td>61.0</td>
      <td>61.0</td>
      <td>15223</td>
      <td>10.14</td>
      <td>10.10</td>
      <td>6.17</td>
    </tr>
    <tr>
      <th>25999</th>
      <td>4.01</td>
      <td>Premium</td>
      <td>J</td>
      <td>I1</td>
      <td>62.5</td>
      <td>62.0</td>
      <td>15223</td>
      <td>10.02</td>
      <td>9.94</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>26444</th>
      <td>4.00</td>
      <td>Very Good</td>
      <td>I</td>
      <td>I1</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>15984</td>
      <td>10.01</td>
      <td>9.94</td>
      <td>6.31</td>
    </tr>
    <tr>
      <th>27415</th>
      <td>5.01</td>
      <td>Fair</td>
      <td>J</td>
      <td>I1</td>
      <td>65.5</td>
      <td>59.0</td>
      <td>18018</td>
      <td>10.74</td>
      <td>10.54</td>
      <td>6.98</td>
    </tr>
    <tr>
      <th>27630</th>
      <td>4.50</td>
      <td>Fair</td>
      <td>J</td>
      <td>I1</td>
      <td>65.8</td>
      <td>58.0</td>
      <td>18531</td>
      <td>10.23</td>
      <td>10.16</td>
      <td>6.72</td>
    </tr>
  </tbody>
</table>
</div>



## 조건문


```python
# 두개는 같은 의미
df.query('carat in [2,2.5]')
df.query('carat == [2,2.5]')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11634</th>
      <td>2.0</td>
      <td>Premium</td>
      <td>J</td>
      <td>I1</td>
      <td>61.5</td>
      <td>59.0</td>
      <td>5051</td>
      <td>8.11</td>
      <td>8.06</td>
      <td>4.97</td>
    </tr>
    <tr>
      <th>13929</th>
      <td>2.0</td>
      <td>Fair</td>
      <td>I</td>
      <td>I1</td>
      <td>66.0</td>
      <td>60.0</td>
      <td>5667</td>
      <td>7.78</td>
      <td>7.74</td>
      <td>5.10</td>
    </tr>
    <tr>
      <th>14645</th>
      <td>2.0</td>
      <td>Fair</td>
      <td>H</td>
      <td>I1</td>
      <td>69.8</td>
      <td>54.0</td>
      <td>5914</td>
      <td>7.60</td>
      <td>7.56</td>
      <td>5.29</td>
    </tr>
    <tr>
      <th>15861</th>
      <td>2.0</td>
      <td>Premium</td>
      <td>H</td>
      <td>I1</td>
      <td>59.7</td>
      <td>62.0</td>
      <td>6344</td>
      <td>8.19</td>
      <td>8.02</td>
      <td>4.85</td>
    </tr>
    <tr>
      <th>16298</th>
      <td>2.0</td>
      <td>Good</td>
      <td>J</td>
      <td>I1</td>
      <td>63.6</td>
      <td>62.0</td>
      <td>6521</td>
      <td>7.97</td>
      <td>7.80</td>
      <td>5.02</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27683</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>E</td>
      <td>SI1</td>
      <td>60.5</td>
      <td>59.0</td>
      <td>18709</td>
      <td>8.09</td>
      <td>8.14</td>
      <td>4.94</td>
    </tr>
    <tr>
      <th>27729</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>F</td>
      <td>SI1</td>
      <td>57.9</td>
      <td>60.0</td>
      <td>18759</td>
      <td>8.28</td>
      <td>8.34</td>
      <td>4.81</td>
    </tr>
    <tr>
      <th>27743</th>
      <td>2.0</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS1</td>
      <td>60.8</td>
      <td>59.0</td>
      <td>18795</td>
      <td>8.13</td>
      <td>8.02</td>
      <td>4.91</td>
    </tr>
    <tr>
      <th>27745</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>H</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>57.0</td>
      <td>18803</td>
      <td>7.95</td>
      <td>8.00</td>
      <td>5.01</td>
    </tr>
    <tr>
      <th>27748</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>G</td>
      <td>SI1</td>
      <td>63.5</td>
      <td>56.0</td>
      <td>18818</td>
      <td>7.90</td>
      <td>7.97</td>
      <td>5.04</td>
    </tr>
  </tbody>
</table>
<p>282 rows × 10 columns</p>
</div>




```python
df.query('carat not in [2,3]')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
    </tr>
  </tbody>
</table>
<p>53667 rows × 10 columns</p>
</div>




```python
# and 를 주면  몇개의 조건들을 엮을 수 있다.
df.query('carat == [2,2.1] & price > 15000')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25887</th>
      <td>2.1</td>
      <td>Premium</td>
      <td>I</td>
      <td>SI1</td>
      <td>61.5</td>
      <td>57.0</td>
      <td>15007</td>
      <td>8.25</td>
      <td>8.21</td>
      <td>5.06</td>
    </tr>
    <tr>
      <th>25895</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>I</td>
      <td>VS2</td>
      <td>63.5</td>
      <td>59.0</td>
      <td>15025</td>
      <td>7.98</td>
      <td>7.93</td>
      <td>5.05</td>
    </tr>
    <tr>
      <th>25905</th>
      <td>2.1</td>
      <td>Ideal</td>
      <td>H</td>
      <td>SI1</td>
      <td>61.7</td>
      <td>53.0</td>
      <td>15035</td>
      <td>8.30</td>
      <td>8.19</td>
      <td>5.09</td>
    </tr>
    <tr>
      <th>25908</th>
      <td>2.0</td>
      <td>Ideal</td>
      <td>I</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>56.0</td>
      <td>15043</td>
      <td>8.04</td>
      <td>7.95</td>
      <td>5.02</td>
    </tr>
    <tr>
      <th>25912</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>I</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>59.0</td>
      <td>15053</td>
      <td>8.12</td>
      <td>8.17</td>
      <td>4.87</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27683</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>E</td>
      <td>SI1</td>
      <td>60.5</td>
      <td>59.0</td>
      <td>18709</td>
      <td>8.09</td>
      <td>8.14</td>
      <td>4.94</td>
    </tr>
    <tr>
      <th>27729</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>F</td>
      <td>SI1</td>
      <td>57.9</td>
      <td>60.0</td>
      <td>18759</td>
      <td>8.28</td>
      <td>8.34</td>
      <td>4.81</td>
    </tr>
    <tr>
      <th>27743</th>
      <td>2.0</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS1</td>
      <td>60.8</td>
      <td>59.0</td>
      <td>18795</td>
      <td>8.13</td>
      <td>8.02</td>
      <td>4.91</td>
    </tr>
    <tr>
      <th>27745</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>H</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>57.0</td>
      <td>18803</td>
      <td>7.95</td>
      <td>8.00</td>
      <td>5.01</td>
    </tr>
    <tr>
      <th>27748</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>G</td>
      <td>SI1</td>
      <td>63.5</td>
      <td>56.0</td>
      <td>18818</td>
      <td>7.90</td>
      <td>7.97</td>
      <td>5.04</td>
    </tr>
  </tbody>
</table>
<p>145 rows × 10 columns</p>
</div>



## 외부 변수 참조 연산


```python
# 외부 변수를 참조하고 싶을 경우 골뱅이@ 를 변수 앞에 넣어주어야 한다.
lis = [2,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9]
df.query('carat == @lis & price > 15000')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25887</th>
      <td>2.1</td>
      <td>Premium</td>
      <td>I</td>
      <td>SI1</td>
      <td>61.5</td>
      <td>57.0</td>
      <td>15007</td>
      <td>8.25</td>
      <td>8.21</td>
      <td>5.06</td>
    </tr>
    <tr>
      <th>25895</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>I</td>
      <td>VS2</td>
      <td>63.5</td>
      <td>59.0</td>
      <td>15025</td>
      <td>7.98</td>
      <td>7.93</td>
      <td>5.05</td>
    </tr>
    <tr>
      <th>25900</th>
      <td>2.8</td>
      <td>Premium</td>
      <td>I</td>
      <td>SI2</td>
      <td>61.1</td>
      <td>59.0</td>
      <td>15030</td>
      <td>9.03</td>
      <td>8.98</td>
      <td>5.50</td>
    </tr>
    <tr>
      <th>25905</th>
      <td>2.1</td>
      <td>Ideal</td>
      <td>H</td>
      <td>SI1</td>
      <td>61.7</td>
      <td>53.0</td>
      <td>15035</td>
      <td>8.30</td>
      <td>8.19</td>
      <td>5.09</td>
    </tr>
    <tr>
      <th>25908</th>
      <td>2.0</td>
      <td>Ideal</td>
      <td>I</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>56.0</td>
      <td>15043</td>
      <td>8.04</td>
      <td>7.95</td>
      <td>5.02</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>27729</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>F</td>
      <td>SI1</td>
      <td>57.9</td>
      <td>60.0</td>
      <td>18759</td>
      <td>8.28</td>
      <td>8.34</td>
      <td>4.81</td>
    </tr>
    <tr>
      <th>27739</th>
      <td>2.8</td>
      <td>Good</td>
      <td>G</td>
      <td>SI2</td>
      <td>63.8</td>
      <td>58.0</td>
      <td>18788</td>
      <td>8.90</td>
      <td>8.85</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>27743</th>
      <td>2.0</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS1</td>
      <td>60.8</td>
      <td>59.0</td>
      <td>18795</td>
      <td>8.13</td>
      <td>8.02</td>
      <td>4.91</td>
    </tr>
    <tr>
      <th>27745</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>H</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>57.0</td>
      <td>18803</td>
      <td>7.95</td>
      <td>8.00</td>
      <td>5.01</td>
    </tr>
    <tr>
      <th>27748</th>
      <td>2.0</td>
      <td>Very Good</td>
      <td>G</td>
      <td>SI1</td>
      <td>63.5</td>
      <td>56.0</td>
      <td>18818</td>
      <td>7.90</td>
      <td>7.97</td>
      <td>5.04</td>
    </tr>
  </tbody>
</table>
<p>199 rows × 10 columns</p>
</div>




```python
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 10 columns</p>
</div>



# eval

- 위의 Query 문은 각 변수들에 대해서 '조건' 에 맞는 변수들을 만들어 냈다
- 하지만 eval 문은 각 변수들에 대해 '연산' 을 쉽게 수행해준다.

## 기본 성질

- pandas.eval(expr, inplace=False) 의 형태를 가진다.
- 수치 연산을 입력하면 숫자 데이터 타입의 Series가 나온다.
- 기본적으로 퍼포먼스가 일반적 연산보다 빠르다고.. 하지만 어느정도 비슷한 상황이 많이 나와서 굳이 쓰는것은 잘 모르겠다
- 이 경우도 퀴리와 같이 메모리를 save 하는데에 그 의의가 있다.


```python
nrows, ncols = 100000, 100
rng = np.random.RandomState(42)
df1, df2, df3, df4 = (pd.DataFrame(rng.rand(nrows, ncols))
                      for i in range(4))

```


```python
%%timeit -n 10 -r 3 
df1 + df2 + df3 + df4
```

    124 ms ± 6.16 ms per loop (mean ± std. dev. of 3 runs, 10 loops each)
    


```python
%%timeit -n 10 -r 3 
pd.eval('df1 + df2 + df3 + df4')
```

    123 ms ± 2.88 ms per loop (mean ± std. dev. of 3 runs, 10 loops each)
    

## 기본 연산


```python
df1, df2, df3, df4, df5 = (pd.DataFrame(rng.randint(0, 1000, (100, 3)))
                           for i in range(5))
```


```python
result1 = -df1 * df2 / (df3 + df4) - df5
result2 = pd.eval('-df1 * df2 / (df3 + df4) - df5')
np.allclose(result1, result2)
```




    True



## 비교 및 조건 연산


```python
result1 = (df1 < df2) & (df2 <= df3) & (df3 != df4)
result2 = pd.eval('df1 < df2 <= df3 != df4')
np.allclose(result1, result2)
```




    True



# 자주 맞딱뜨리는 예제

## 같은 범주끼리 연산 후 합치기

- 다이아몬드 데이터에 대해, color 별로 carat 의 mean 을 계산한 이후에 각 데이터 옆에다 붙이자.
- 통상적인 Regression 문제에서 변수를 늘리고자 할 때에 많이 맞딱뜨리는 경우이다.


```python
df = diamonds.copy()
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 10 columns</p>
</div>




```python
# transform 은 들어온 함수에 대해 각각 연산을 수행한 이후, sample 들은 살린다. 
# 그래서 옆에 데이터를 붙이려는 우리의 목적에 매우 부합하다.
# 이 때에 df['carat'] 의 데이터에 df['color'] 에 맞게 group by 를 해주는 것 이기 때문에 아래처럼 각각 columns 를 명시해 주어야 한다.
df['carat'].groupby(df['color']).transform(np.mean)
```




    0        0.657867
    1        0.657867
    2        0.657867
    3        1.026927
    4        1.162137
               ...   
    53935    0.657795
    53936    0.657795
    53937    0.657795
    53938    0.911799
    53939    0.657795
    Name: carat, Length: 53940, dtype: float64




```python
df['carat_mean']= df['carat'].groupby(df['color']).transform(np.mean)
```


```python
# 원하는 결과가 나온 모습
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>carat_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
      <td>1.026927</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
      <td>1.162137</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
      <td>0.911799</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
      <td>0.657795</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 11 columns</p>
</div>




```python
# 그냥 실행하게 된다면 아래와 같이 dataframe 을 color 로 모두 쪼갠 뒤에 transform 을 수행한 결과가 나오게 된다.
df.groupby(['color']).transform(np.mean) 
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>carat_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.657867</td>
      <td>61.662090</td>
      <td>57.491201</td>
      <td>3076.752475</td>
      <td>5.411580</td>
      <td>5.419029</td>
      <td>3.340689</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.657867</td>
      <td>61.662090</td>
      <td>57.491201</td>
      <td>3076.752475</td>
      <td>5.411580</td>
      <td>5.419029</td>
      <td>3.340689</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.657867</td>
      <td>61.662090</td>
      <td>57.491201</td>
      <td>3076.752475</td>
      <td>5.411580</td>
      <td>5.419029</td>
      <td>3.340689</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.026927</td>
      <td>61.846385</td>
      <td>57.577278</td>
      <td>5091.874954</td>
      <td>6.222826</td>
      <td>6.222730</td>
      <td>3.845411</td>
      <td>1.026927</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.162137</td>
      <td>61.887215</td>
      <td>57.812393</td>
      <td>5323.818020</td>
      <td>6.519338</td>
      <td>6.518105</td>
      <td>4.033251</td>
      <td>1.162137</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.657795</td>
      <td>61.698125</td>
      <td>57.404590</td>
      <td>3169.954096</td>
      <td>5.417051</td>
      <td>5.421128</td>
      <td>3.342827</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.657795</td>
      <td>61.698125</td>
      <td>57.404590</td>
      <td>3169.954096</td>
      <td>5.417051</td>
      <td>5.421128</td>
      <td>3.342827</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.657795</td>
      <td>61.698125</td>
      <td>57.404590</td>
      <td>3169.954096</td>
      <td>5.417051</td>
      <td>5.421128</td>
      <td>3.342827</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.911799</td>
      <td>61.836850</td>
      <td>57.517811</td>
      <td>4486.669196</td>
      <td>5.983335</td>
      <td>5.984815</td>
      <td>3.695965</td>
      <td>0.911799</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.657795</td>
      <td>61.698125</td>
      <td>57.404590</td>
      <td>3169.954096</td>
      <td>5.417051</td>
      <td>5.421128</td>
      <td>3.342827</td>
      <td>0.657795</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 8 columns</p>
</div>




```python
# 이런식으로 agg 를 쓰게 된다면 data table 을 보여주고 끝이 난다.
df.groupby(['color']).agg(np.mean)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>carat_mean</th>
    </tr>
    <tr>
      <th>color</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>D</th>
      <td>0.657795</td>
      <td>61.698125</td>
      <td>57.404590</td>
      <td>3169.954096</td>
      <td>5.417051</td>
      <td>5.421128</td>
      <td>3.342827</td>
      <td>0.657795</td>
    </tr>
    <tr>
      <th>E</th>
      <td>0.657867</td>
      <td>61.662090</td>
      <td>57.491201</td>
      <td>3076.752475</td>
      <td>5.411580</td>
      <td>5.419029</td>
      <td>3.340689</td>
      <td>0.657867</td>
    </tr>
    <tr>
      <th>F</th>
      <td>0.736538</td>
      <td>61.694582</td>
      <td>57.433536</td>
      <td>3724.886397</td>
      <td>5.614961</td>
      <td>5.619456</td>
      <td>3.464446</td>
      <td>0.736538</td>
    </tr>
    <tr>
      <th>G</th>
      <td>0.771190</td>
      <td>61.757111</td>
      <td>57.288629</td>
      <td>3999.135671</td>
      <td>5.677543</td>
      <td>5.680192</td>
      <td>3.505021</td>
      <td>0.771190</td>
    </tr>
    <tr>
      <th>H</th>
      <td>0.911799</td>
      <td>61.836850</td>
      <td>57.517811</td>
      <td>4486.669196</td>
      <td>5.983335</td>
      <td>5.984815</td>
      <td>3.695965</td>
      <td>0.911799</td>
    </tr>
    <tr>
      <th>I</th>
      <td>1.026927</td>
      <td>61.846385</td>
      <td>57.577278</td>
      <td>5091.874954</td>
      <td>6.222826</td>
      <td>6.222730</td>
      <td>3.845411</td>
      <td>1.026927</td>
    </tr>
    <tr>
      <th>J</th>
      <td>1.162137</td>
      <td>61.887215</td>
      <td>57.812393</td>
      <td>5323.818020</td>
      <td>6.519338</td>
      <td>6.518105</td>
      <td>4.033251</td>
      <td>1.162137</td>
    </tr>
  </tbody>
</table>
</div>



## 현재값 - 이전값 을 이용해 변화량 넣기

- 주로 시계열 데이터에서 자주 이루어지는 연산이다.
- index 가 시간적 의미를 가지고 있다면, 이전 데이터 - 이후 데이터 = 변화량 이므로 이를 이용해 유의미한 정보를 이끌어 낼 수 있다.


```python
df = diamonds.copy()
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 10 columns</p>
</div>




```python
# 아래와 같이 shift 연산을 통해서 데이터 자체의 index 를 더하거나 뺼 수 있다. 
# 즉 index 가 커질수록 나중인 시계열 데이터 특성상 shift(1) 은 이전 시점의 데이터를 앞으로 끌어온 것이다. 
df['diff_carat'] = df['carat'] - df['carat'].shift(1) # 오늘값 - 어제값 즉 carat 의 증가량이다. 
```


```python
# 이때 중요한것은, 필연적으로 위같은 연산시 nan 값이 나타난다는 것이다. 
# 시간을 이용해 연산하기 떄문에 어쩔 수 없이 나타나는 현상이다.
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>diff_carat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
      <td>-0.02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
      <td>-0.02</td>
    </tr>
    <tr>
      <th>53938</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>53939</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
      <td>-0.11</td>
    </tr>
  </tbody>
</table>
<p>53940 rows × 11 columns</p>
</div>




```python
df = df[1:] # 앞의 첫번째값은, 과거값이 없어서 nan 값이 나온다. 즉 없애줌 
df.reset_index(drop = True,inplace=True) # index 를 초기화해 준다. 
```


```python
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>diff_carat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.24</td>
      <td>Very Good</td>
      <td>J</td>
      <td>VVS2</td>
      <td>62.8</td>
      <td>57.0</td>
      <td>336</td>
      <td>3.94</td>
      <td>3.96</td>
      <td>2.48</td>
      <td>-0.07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.24</td>
      <td>Very Good</td>
      <td>I</td>
      <td>VVS1</td>
      <td>62.3</td>
      <td>57.0</td>
      <td>336</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.47</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53933</th>
      <td>0.72</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI1</td>
      <td>60.8</td>
      <td>57.0</td>
      <td>2757</td>
      <td>5.75</td>
      <td>5.76</td>
      <td>3.50</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>53934</th>
      <td>0.72</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.1</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.69</td>
      <td>5.75</td>
      <td>3.61</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>53935</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>62.8</td>
      <td>60.0</td>
      <td>2757</td>
      <td>5.66</td>
      <td>5.68</td>
      <td>3.56</td>
      <td>-0.02</td>
    </tr>
    <tr>
      <th>53936</th>
      <td>0.86</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>2757</td>
      <td>6.15</td>
      <td>6.12</td>
      <td>3.74</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>53937</th>
      <td>0.75</td>
      <td>Ideal</td>
      <td>D</td>
      <td>SI2</td>
      <td>62.2</td>
      <td>55.0</td>
      <td>2757</td>
      <td>5.83</td>
      <td>5.87</td>
      <td>3.64</td>
      <td>-0.11</td>
    </tr>
  </tbody>
</table>
<p>53938 rows × 11 columns</p>
</div>


