---
title:  "특정 지역 시각화"
excerpt: "특정 지역의 시각화"
categories:
  - Tab_Dash
tags:
  - 3
last_modified_at: 2021-03-16

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true

use_math : true
---

#result

우선 어떻게 아래와 같은 시각화를 만들었는지부터 살펴보자. 내가 이전에 한 시각화랑 달리 쉬워보이고 별거 아닌거같아 보여도, 이렇게 구성하는게 정말 힘들었다는것만 알아주세요.. 😭😭😭😭😭

![png](/assets/images/Tableau_ex/3_1.PNG)



# 뭐가 힘들었나요?

1. **테블로는 최대 '시군구' 까지만 알려준다.**
   - 즉 위의 시각화는 전주시에서 어디에서 어느정도로 많은 유기견/유기묘를 전담하면서 살펴보고있는지를 알려주는 시각화이다. 여기서 문제는 '전주시' 라는것이다. 전주시 안에도 수많은 읍 / 면/  동이 존재한다. 그렇다면 이것을 어떻게 처리할 수 있을까? 
   - 그건 바로 shp 맵 파일을 직접 테블로에 연결하는것이다. 직접 읍면동 지리 데이터를 공수해서 내가 일일히 데이터를 만져야 한다는것.. 
2. **사용하는 코드가 다르다.**
   - 통계청과 행정안전부에서 사용하는 지역 코드가 다르다... 😪 그래서 내가 가지고 있는 지역 코드가 어느부서에서 통용되는 코드인지 찾는 과정이 정말 오래걸렸다. 
   - 결론은 행정동코드의 앞 8자리를 사용한 것이였다! (만든 사람마다 definition 이 달라서 shp 파일마다 그 코드의 의미가 살짝씩 달라지는거같다....)

3. **인코딩 안맞음 /데이터 시트 붙여줘야됨.... 등의 사소한 귀찮음**
   - 그리고 무엇보다 자료가 부족하다. Tableau 가 엄청 많이 쓰이는건 아니라그런지 생각보다 별로 자료가 없더라..



# 1. SHP 파일 글자가 깨지는 문제

<http://www.gisdeveloper.co.kr/?p=2332> 에서 최신 행정구역을 다운로드 하자. 그런데 이때 

 다음과 같이 Spatial file 에서 shp 파일을 얻어보았다. 

![png](/assets/images/Tableau_ex/3_2.PNG)

이때, 다음과 같이 emd(읍면동) 의 korea name 이 이상하게 나오고 있다. 이는 바로 인코딩 문제로, 태블로에 올리려면 utf 를 써야한다고 한다. 그러므로 이 shp 파일을 유니코드 문법으로 고쳐주어야 한다. 

![png](/assets/images/Tableau_ex/3_3.PNG)

저 작업을 위해서는 qgis 가 필요하다. 필요한 사람은 알아서 설치를 하자.

![png](/assets/images/Tableau_ex/3_4.PNG)

이후에 shp 파일을 로드한 후(그냥 끌어서 옮기면 됨) 아래와 같이 다른이름으로 저장한다.

![png](/assets/images/Tableau_ex/3_5.PNG)

여기에서 format 을 ESRI shapefile(shp 파일임) 로 하고, 인코딩을 UTF-8 로 고쳐준다. 그리고 알아서 이름 정해서 저장하자. 그 파일을 태블로로 불러온다면? 

![png](/assets/images/Tableau_ex/3_6.PNG)

이제 좀 잘나오는듯 하다.

![png](/assets/images/Tableau_ex/3_7.PNG)

이 SHP 를 MAP 에 올려놓게되면 아래와 같이 읍면동이 잘 나오는 모습을 볼 수 있다.

![png](/assets/images/Tableau_ex/3_8.PNG)



# 2. 데이터 연결

이제 맵을 완성했다고 끝이냐? 절대 아니다. 그냥 지역만으로는 아무런 의미가 없기때문에, 다른 정보와 붙여야 비로소 의미가 있는것이다. 아래와 같이 전주시의 유기견에 대한 데이터를 뽑아와 보았다. 여기서 각 유기견의 보호장소가 어디에 있는지, 얼마나 있는지에 대한 시각화를 진행하고 싶다.

![png](/assets/images/Tableau_ex/3_9.PNG)

먼저 아래와 같이 시/구/동 을 나누어 주었다. 왜 이런짓을 했냐면 우리의 읍면동 SHP 데이터는 현재 동(인후동1가, 전주형서로...)으로 나누어져 있는 상태이다. 하지만 아무 데이터나 위에 올린다고 사용할 수 있는것이 아니라 두 데이터를 연결해야 같이 사용할 수 있게 된다. 그 때에 사용되는 key 를 만들기 위해서 두 데이터가 겹치고 있는 동 을 추출한 것이다. (그냥 엑셀에서 split 쓰면된다.)

![png](/assets/images/Tableau_ex/3_10.PNG)

불러온 유기견 데이터 위에 shp 파일을 끌고온다. (끌고오기 전에 태블로에서 한번 불러오기는 해야되는거 같더라.)

![png](/assets/images/Tableau_ex/3_11.PNG)

그 이후에 읍면동과 전주시의 key 를 넣어서 연결해준다. 

![png](/assets/images/Tableau_ex/3_12.PNG)

제대로 연결이 되었으면 아래의 시각화와 같은 모습을 보이게 된다.

![png](/assets/images/Tableau_ex/3_13.PNG)

이때 동을 색깔로 올리게되면 이쁜 모습으로 잘 표시되는것을 볼 수 있다.

![png](/assets/images/Tableau_ex/3_14.PNG)



# 3. 지역만 보기

하지만 위 데이터를 볼때 너무 지역이 광범위하여 가시성이 좋지 않다. 그렇다고 필터를 씌우기에는 어디까지가 '전주시' 일지 모르기 때문에 난감하다. 어느 지역이 전주일까? 전주시의 읍면동 코드를 모두 알면 filter 를 통해서 전주시만 나타낼 수 있지 않을까? 

아래와 같이 법정동 코드 전체 자료를 받는다. 우리 shp 자료는 8 자리인데, 이는 법정동 코드 앞의 8자리라고 한다. (실험결과도 맞는듯 하다! ) 

![png](/assets/images/Tableau_ex/3_15.PNG)

여기에서 법정동 코드의 앞 8자리만 추출하도록 코드를 짠 후. 데이터 필터를 씌운다음에, 법정동명에서 전주시의 코드를 모두 복사한다. 

![png](/assets/images/Tableau_ex/3_16.PNG)

그 이후에 아래와 같이 복사한 코드들을 모두 붙여넣는다. Emd Cd 는 읍면동 코드로서, 여기에 모든 전주시의 코드를 넣는다면, 전주시만 나오게 되는것이다.

![png](/assets/images/Tableau_ex/3_17.PNG)

이제 전주시만 나오니 한결 편안해진 모습

![png](/assets/images/Tableau_ex/3_18.PNG)

마지막으로 count 를 넣고, detail 에 한글 주소를 넣으면 끝. 유기견/묘 가 보호되는곳이 상당히 제한적이라는것을 확인할 수 있었다. 

![png](/assets/images/Tableau_ex/3_19.PNG)

결과가 디테일한 시각화는 아니지만, 여기까지만 해도 어떤 지역에 대한 국한된 시각화를 진행하기에 무리가 없을것이다. 더 활용하는건 오히려 앞 부분보다 훨~씬 쉬울것!