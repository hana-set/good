---
title:  "Reshape"
excerpt: "데이터를 녹이고 붙이는 Reshape 패키지를 알아보자."
categories:
  - R_Preprocessing
tags:
  - 전처리
last_modified_at: 2021-02-04

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true
---

# Reshape 패키지
데이터를 녹이고, 다시 구성하는데에 매우 좋다.


{% highlight r %}
library(reshape)
df <- airquality
head(df)
{% endhighlight %}



{% highlight text %}
##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3
## 4    18     313 11.5   62     5   4
## 5    NA      NA 14.3   56     5   5
## 6    28      NA 14.9   66     5   6
{% endhighlight %}



{% highlight r %}
names(df) = tolower(names(df))
{% endhighlight %}

## melt
데이터를 month, day 만 남기고(id) 나머지는 모두 녹인다는 의미<br>
이 때 나머지에 대해서는 녹인 id 를 기준으로 덧붙여진다.

{% highlight r %}
df
{% endhighlight %}



{% highlight text %}
##     ozone solar.r wind temp month day
## 1      41     190  7.4   67     5   1
## 2      36     118  8.0   72     5   2
## 3      12     149 12.6   74     5   3
## 4      18     313 11.5   62     5   4
## 5      NA      NA 14.3   56     5   5
## 6      28      NA 14.9   66     5   6
## 7      23     299  8.6   65     5   7
## 8      19      99 13.8   59     5   8
## 9       8      19 20.1   61     5   9
## 10     NA     194  8.6   69     5  10
## 11      7      NA  6.9   74     5  11
## 12     16     256  9.7   69     5  12
## 13     11     290  9.2   66     5  13
## 14     14     274 10.9   68     5  14
## 15     18      65 13.2   58     5  15
## 16     14     334 11.5   64     5  16
## 17     34     307 12.0   66     5  17
## 18      6      78 18.4   57     5  18
## 19     30     322 11.5   68     5  19
## 20     11      44  9.7   62     5  20
## 21      1       8  9.7   59     5  21
## 22     11     320 16.6   73     5  22
## 23      4      25  9.7   61     5  23
## 24     32      92 12.0   61     5  24
## 25     NA      66 16.6   57     5  25
## 26     NA     266 14.9   58     5  26
## 27     NA      NA  8.0   57     5  27
## 28     23      13 12.0   67     5  28
## 29     45     252 14.9   81     5  29
## 30    115     223  5.7   79     5  30
## 31     37     279  7.4   76     5  31
## 32     NA     286  8.6   78     6   1
## 33     NA     287  9.7   74     6   2
## 34     NA     242 16.1   67     6   3
## 35     NA     186  9.2   84     6   4
## 36     NA     220  8.6   85     6   5
## 37     NA     264 14.3   79     6   6
## 38     29     127  9.7   82     6   7
## 39     NA     273  6.9   87     6   8
## 40     71     291 13.8   90     6   9
## 41     39     323 11.5   87     6  10
## 42     NA     259 10.9   93     6  11
## 43     NA     250  9.2   92     6  12
## 44     23     148  8.0   82     6  13
## 45     NA     332 13.8   80     6  14
## 46     NA     322 11.5   79     6  15
## 47     21     191 14.9   77     6  16
## 48     37     284 20.7   72     6  17
## 49     20      37  9.2   65     6  18
## 50     12     120 11.5   73     6  19
## 51     13     137 10.3   76     6  20
## 52     NA     150  6.3   77     6  21
## 53     NA      59  1.7   76     6  22
## 54     NA      91  4.6   76     6  23
## 55     NA     250  6.3   76     6  24
## 56     NA     135  8.0   75     6  25
## 57     NA     127  8.0   78     6  26
## 58     NA      47 10.3   73     6  27
## 59     NA      98 11.5   80     6  28
## 60     NA      31 14.9   77     6  29
## 61     NA     138  8.0   83     6  30
## 62    135     269  4.1   84     7   1
## 63     49     248  9.2   85     7   2
## 64     32     236  9.2   81     7   3
## 65     NA     101 10.9   84     7   4
## 66     64     175  4.6   83     7   5
## 67     40     314 10.9   83     7   6
## 68     77     276  5.1   88     7   7
## 69     97     267  6.3   92     7   8
## 70     97     272  5.7   92     7   9
## 71     85     175  7.4   89     7  10
## 72     NA     139  8.6   82     7  11
## 73     10     264 14.3   73     7  12
## 74     27     175 14.9   81     7  13
## 75     NA     291 14.9   91     7  14
## 76      7      48 14.3   80     7  15
## 77     48     260  6.9   81     7  16
## 78     35     274 10.3   82     7  17
## 79     61     285  6.3   84     7  18
## 80     79     187  5.1   87     7  19
## 81     63     220 11.5   85     7  20
## 82     16       7  6.9   74     7  21
## 83     NA     258  9.7   81     7  22
## 84     NA     295 11.5   82     7  23
## 85     80     294  8.6   86     7  24
## 86    108     223  8.0   85     7  25
## 87     20      81  8.6   82     7  26
## 88     52      82 12.0   86     7  27
## 89     82     213  7.4   88     7  28
## 90     50     275  7.4   86     7  29
## 91     64     253  7.4   83     7  30
## 92     59     254  9.2   81     7  31
## 93     39      83  6.9   81     8   1
## 94      9      24 13.8   81     8   2
## 95     16      77  7.4   82     8   3
## 96     78      NA  6.9   86     8   4
## 97     35      NA  7.4   85     8   5
## 98     66      NA  4.6   87     8   6
## 99    122     255  4.0   89     8   7
## 100    89     229 10.3   90     8   8
## 101   110     207  8.0   90     8   9
## 102    NA     222  8.6   92     8  10
## 103    NA     137 11.5   86     8  11
## 104    44     192 11.5   86     8  12
## 105    28     273 11.5   82     8  13
## 106    65     157  9.7   80     8  14
## 107    NA      64 11.5   79     8  15
## 108    22      71 10.3   77     8  16
## 109    59      51  6.3   79     8  17
## 110    23     115  7.4   76     8  18
## 111    31     244 10.9   78     8  19
## 112    44     190 10.3   78     8  20
## 113    21     259 15.5   77     8  21
## 114     9      36 14.3   72     8  22
## 115    NA     255 12.6   75     8  23
## 116    45     212  9.7   79     8  24
## 117   168     238  3.4   81     8  25
## 118    73     215  8.0   86     8  26
## 119    NA     153  5.7   88     8  27
## 120    76     203  9.7   97     8  28
## 121   118     225  2.3   94     8  29
## 122    84     237  6.3   96     8  30
## 123    85     188  6.3   94     8  31
## 124    96     167  6.9   91     9   1
## 125    78     197  5.1   92     9   2
## 126    73     183  2.8   93     9   3
## 127    91     189  4.6   93     9   4
## 128    47      95  7.4   87     9   5
## 129    32      92 15.5   84     9   6
## 130    20     252 10.9   80     9   7
## 131    23     220 10.3   78     9   8
## 132    21     230 10.9   75     9   9
## 133    24     259  9.7   73     9  10
## 134    44     236 14.9   81     9  11
## 135    21     259 15.5   76     9  12
## 136    28     238  6.3   77     9  13
## 137     9      24 10.9   71     9  14
## 138    13     112 11.5   71     9  15
## 139    46     237  6.9   78     9  16
## 140    18     224 13.8   67     9  17
## 141    13      27 10.3   76     9  18
## 142    24     238 10.3   68     9  19
## 143    16     201  8.0   82     9  20
## 144    13     238 12.6   64     9  21
## 145    23      14  9.2   71     9  22
## 146    36     139 10.3   81     9  23
## 147     7      49 10.3   69     9  24
## 148    14      20 16.6   63     9  25
## 149    30     193  6.9   70     9  26
## 150    NA     145 13.2   77     9  27
## 151    14     191 14.3   75     9  28
## 152    18     131  8.0   76     9  29
## 153    20     223 11.5   68     9  30
{% endhighlight %}



{% highlight r %}
# melt 시에 na.rm 을 TRUE 로 하면, NA 를 모두 제거한다.
df_melt = melt(df,id = c('month','day'),na.rm=TRUE)
df_melt
{% endhighlight %}



{% highlight text %}
##     month day variable value
## 1       5   1    ozone    41
## 2       5   2    ozone    36
## 3       5   3    ozone    12
## 4       5   4    ozone    18
## 5       5   6    ozone    28
## 6       5   7    ozone    23
## 7       5   8    ozone    19
## 8       5   9    ozone     8
## 9       5  11    ozone     7
## 10      5  12    ozone    16
## 11      5  13    ozone    11
## 12      5  14    ozone    14
## 13      5  15    ozone    18
## 14      5  16    ozone    14
## 15      5  17    ozone    34
## 16      5  18    ozone     6
## 17      5  19    ozone    30
## 18      5  20    ozone    11
## 19      5  21    ozone     1
## 20      5  22    ozone    11
## 21      5  23    ozone     4
## 22      5  24    ozone    32
## 23      5  28    ozone    23
## 24      5  29    ozone    45
## 25      5  30    ozone   115
## 26      5  31    ozone    37
## 27      6   7    ozone    29
## 28      6   9    ozone    71
## 29      6  10    ozone    39
## 30      6  13    ozone    23
## 31      6  16    ozone    21
## 32      6  17    ozone    37
## 33      6  18    ozone    20
## 34      6  19    ozone    12
## 35      6  20    ozone    13
## 36      7   1    ozone   135
## 37      7   2    ozone    49
## 38      7   3    ozone    32
## 39      7   5    ozone    64
## 40      7   6    ozone    40
## 41      7   7    ozone    77
## 42      7   8    ozone    97
## 43      7   9    ozone    97
## 44      7  10    ozone    85
## 45      7  12    ozone    10
## 46      7  13    ozone    27
## 47      7  15    ozone     7
## 48      7  16    ozone    48
## 49      7  17    ozone    35
## 50      7  18    ozone    61
## 51      7  19    ozone    79
## 52      7  20    ozone    63
## 53      7  21    ozone    16
## 54      7  24    ozone    80
## 55      7  25    ozone   108
## 56      7  26    ozone    20
## 57      7  27    ozone    52
## 58      7  28    ozone    82
## 59      7  29    ozone    50
## 60      7  30    ozone    64
## 61      7  31    ozone    59
## 62      8   1    ozone    39
## 63      8   2    ozone     9
## 64      8   3    ozone    16
## 65      8   4    ozone    78
## 66      8   5    ozone    35
## 67      8   6    ozone    66
## 68      8   7    ozone   122
## 69      8   8    ozone    89
## 70      8   9    ozone   110
## 71      8  12    ozone    44
## 72      8  13    ozone    28
## 73      8  14    ozone    65
## 74      8  16    ozone    22
## 75      8  17    ozone    59
## 76      8  18    ozone    23
## 77      8  19    ozone    31
## 78      8  20    ozone    44
## 79      8  21    ozone    21
## 80      8  22    ozone     9
## 81      8  24    ozone    45
## 82      8  25    ozone   168
## 83      8  26    ozone    73
## 84      8  28    ozone    76
## 85      8  29    ozone   118
## 86      8  30    ozone    84
## 87      8  31    ozone    85
## 88      9   1    ozone    96
## 89      9   2    ozone    78
## 90      9   3    ozone    73
## 91      9   4    ozone    91
## 92      9   5    ozone    47
## 93      9   6    ozone    32
## 94      9   7    ozone    20
## 95      9   8    ozone    23
## 96      9   9    ozone    21
## 97      9  10    ozone    24
## 98      9  11    ozone    44
## 99      9  12    ozone    21
## 100     9  13    ozone    28
## 101     9  14    ozone     9
## 102     9  15    ozone    13
## 103     9  16    ozone    46
## 104     9  17    ozone    18
## 105     9  18    ozone    13
## 106     9  19    ozone    24
## 107     9  20    ozone    16
## 108     9  21    ozone    13
## 109     9  22    ozone    23
## 110     9  23    ozone    36
## 111     9  24    ozone     7
## 112     9  25    ozone    14
## 113     9  26    ozone    30
## 114     9  28    ozone    14
## 115     9  29    ozone    18
## 116     9  30    ozone    20
## 117     5   1  solar.r   190
## 118     5   2  solar.r   118
## 119     5   3  solar.r   149
## 120     5   4  solar.r   313
## 121     5   7  solar.r   299
## 122     5   8  solar.r    99
## 123     5   9  solar.r    19
## 124     5  10  solar.r   194
## 125     5  12  solar.r   256
## 126     5  13  solar.r   290
## 127     5  14  solar.r   274
## 128     5  15  solar.r    65
## 129     5  16  solar.r   334
## 130     5  17  solar.r   307
## 131     5  18  solar.r    78
## 132     5  19  solar.r   322
## 133     5  20  solar.r    44
## 134     5  21  solar.r     8
## 135     5  22  solar.r   320
## 136     5  23  solar.r    25
## 137     5  24  solar.r    92
## 138     5  25  solar.r    66
## 139     5  26  solar.r   266
## 140     5  28  solar.r    13
## 141     5  29  solar.r   252
## 142     5  30  solar.r   223
## 143     5  31  solar.r   279
## 144     6   1  solar.r   286
## 145     6   2  solar.r   287
## 146     6   3  solar.r   242
## 147     6   4  solar.r   186
## 148     6   5  solar.r   220
## 149     6   6  solar.r   264
## 150     6   7  solar.r   127
## 151     6   8  solar.r   273
## 152     6   9  solar.r   291
## 153     6  10  solar.r   323
## 154     6  11  solar.r   259
## 155     6  12  solar.r   250
## 156     6  13  solar.r   148
## 157     6  14  solar.r   332
## 158     6  15  solar.r   322
## 159     6  16  solar.r   191
## 160     6  17  solar.r   284
## 161     6  18  solar.r    37
## 162     6  19  solar.r   120
## 163     6  20  solar.r   137
## 164     6  21  solar.r   150
## 165     6  22  solar.r    59
## 166     6  23  solar.r    91
## 167     6  24  solar.r   250
## 168     6  25  solar.r   135
## 169     6  26  solar.r   127
## 170     6  27  solar.r    47
## 171     6  28  solar.r    98
## 172     6  29  solar.r    31
## 173     6  30  solar.r   138
## 174     7   1  solar.r   269
## 175     7   2  solar.r   248
## 176     7   3  solar.r   236
## 177     7   4  solar.r   101
## 178     7   5  solar.r   175
## 179     7   6  solar.r   314
## 180     7   7  solar.r   276
## 181     7   8  solar.r   267
## 182     7   9  solar.r   272
## 183     7  10  solar.r   175
## 184     7  11  solar.r   139
## 185     7  12  solar.r   264
## 186     7  13  solar.r   175
## 187     7  14  solar.r   291
## 188     7  15  solar.r    48
## 189     7  16  solar.r   260
## 190     7  17  solar.r   274
## 191     7  18  solar.r   285
## 192     7  19  solar.r   187
## 193     7  20  solar.r   220
## 194     7  21  solar.r     7
## 195     7  22  solar.r   258
## 196     7  23  solar.r   295
## 197     7  24  solar.r   294
## 198     7  25  solar.r   223
## 199     7  26  solar.r    81
## 200     7  27  solar.r    82
## 201     7  28  solar.r   213
## 202     7  29  solar.r   275
## 203     7  30  solar.r   253
## 204     7  31  solar.r   254
## 205     8   1  solar.r    83
## 206     8   2  solar.r    24
## 207     8   3  solar.r    77
## 208     8   7  solar.r   255
## 209     8   8  solar.r   229
## 210     8   9  solar.r   207
## 211     8  10  solar.r   222
## 212     8  11  solar.r   137
## 213     8  12  solar.r   192
## 214     8  13  solar.r   273
## 215     8  14  solar.r   157
## 216     8  15  solar.r    64
## 217     8  16  solar.r    71
## 218     8  17  solar.r    51
## 219     8  18  solar.r   115
## 220     8  19  solar.r   244
## 221     8  20  solar.r   190
## 222     8  21  solar.r   259
## 223     8  22  solar.r    36
## 224     8  23  solar.r   255
## 225     8  24  solar.r   212
## 226     8  25  solar.r   238
## 227     8  26  solar.r   215
## 228     8  27  solar.r   153
## 229     8  28  solar.r   203
## 230     8  29  solar.r   225
## 231     8  30  solar.r   237
## 232     8  31  solar.r   188
## 233     9   1  solar.r   167
## 234     9   2  solar.r   197
## 235     9   3  solar.r   183
## 236     9   4  solar.r   189
## 237     9   5  solar.r    95
## 238     9   6  solar.r    92
## 239     9   7  solar.r   252
## 240     9   8  solar.r   220
## 241     9   9  solar.r   230
## 242     9  10  solar.r   259
## 243     9  11  solar.r   236
## 244     9  12  solar.r   259
## 245     9  13  solar.r   238
## 246     9  14  solar.r    24
## 247     9  15  solar.r   112
## 248     9  16  solar.r   237
## 249     9  17  solar.r   224
## 250     9  18  solar.r    27
##  [ reached 'max' / getOption("max.print") -- omitted 318 rows ]
{% endhighlight %}
## cast
녹인 melt 에 cast 를 적용해서 pivot table 을 구성하자. <br>

{% highlight r %}
# 아무 function 을 지정하지 않아 그 변수에 해당하는 값이 나온다.
cast(df_melt,day~month~variable)
{% endhighlight %}



{% highlight text %}
## , , variable = ozone
## 
##     month
## day    5  6   7   8  9
##   1   41 NA 135  39 96
##   2   36 NA  49   9 78
##   3   12 NA  32  16 73
##   4   18 NA  NA  78 91
##   5   NA NA  64  35 47
##   6   28 NA  40  66 32
##   7   23 29  77 122 20
##   8   19 NA  97  89 23
##   9    8 71  97 110 21
##   10  NA 39  85  NA 24
##   11   7 NA  NA  NA 44
##   12  16 NA  10  44 21
##   13  11 23  27  28 28
##   14  14 NA  NA  65  9
##   15  18 NA   7  NA 13
##   16  14 21  48  22 46
##   17  34 37  35  59 18
##   18   6 20  61  23 13
##   19  30 12  79  31 24
##   20  11 13  63  44 16
##   21   1 NA  16  21 13
##   22  11 NA  NA   9 23
##   23   4 NA  NA  NA 36
##   24  32 NA  80  45  7
##   25  NA NA 108 168 14
##   26  NA NA  20  73 30
##   27  NA NA  52  NA NA
##   28  23 NA  82  76 14
##   29  45 NA  50 118 18
##   30 115 NA  64  84 20
##   31  37 NA  59  85 NA
## 
## , , variable = solar.r
## 
##     month
## day    5   6   7   8   9
##   1  190 286 269  83 167
##   2  118 287 248  24 197
##   3  149 242 236  77 183
##   4  313 186 101  NA 189
##   5   NA 220 175  NA  95
##   6   NA 264 314  NA  92
##   7  299 127 276 255 252
##   8   99 273 267 229 220
##   9   19 291 272 207 230
##   10 194 323 175 222 259
##   11  NA 259 139 137 236
##   12 256 250 264 192 259
##   13 290 148 175 273 238
##   14 274 332 291 157  24
##   15  65 322  48  64 112
##   16 334 191 260  71 237
##   17 307 284 274  51 224
##   18  78  37 285 115  27
##   19 322 120 187 244 238
##   20  44 137 220 190 201
##   21   8 150   7 259 238
##   22 320  59 258  36  14
##   23  25  91 295 255 139
##   24  92 250 294 212  49
##   25  66 135 223 238  20
##   26 266 127  81 215 193
##   27  NA  47  82 153 145
##   28  13  98 213 203 191
##   29 252  31 275 225 131
##   30 223 138 253 237 223
##   31 279  NA 254 188  NA
## 
## , , variable = wind
## 
##     month
## day     5    6    7    8    9
##   1   7.4  8.6  4.1  6.9  6.9
##   2   8.0  9.7  9.2 13.8  5.1
##   3  12.6 16.1  9.2  7.4  2.8
##   4  11.5  9.2 10.9  6.9  4.6
##   5  14.3  8.6  4.6  7.4  7.4
##   6  14.9 14.3 10.9  4.6 15.5
##   7   8.6  9.7  5.1  4.0 10.9
##   8  13.8  6.9  6.3 10.3 10.3
##   9  20.1 13.8  5.7  8.0 10.9
##   10  8.6 11.5  7.4  8.6  9.7
##   11  6.9 10.9  8.6 11.5 14.9
##   12  9.7  9.2 14.3 11.5 15.5
##   13  9.2  8.0 14.9 11.5  6.3
##   14 10.9 13.8 14.9  9.7 10.9
##   15 13.2 11.5 14.3 11.5 11.5
##   16 11.5 14.9  6.9 10.3  6.9
##   17 12.0 20.7 10.3  6.3 13.8
##   18 18.4  9.2  6.3  7.4 10.3
##   19 11.5 11.5  5.1 10.9 10.3
##   20  9.7 10.3 11.5 10.3  8.0
##   21  9.7  6.3  6.9 15.5 12.6
##   22 16.6  1.7  9.7 14.3  9.2
##   23  9.7  4.6 11.5 12.6 10.3
##   24 12.0  6.3  8.6  9.7 10.3
##   25 16.6  8.0  8.0  3.4 16.6
##   26 14.9  8.0  8.6  8.0  6.9
##   27  8.0 10.3 12.0  5.7 13.2
##   28 12.0 11.5  7.4  9.7 14.3
##   29 14.9 14.9  7.4  2.3  8.0
##   30  5.7  8.0  7.4  6.3 11.5
##   31  7.4   NA  9.2  6.3   NA
## 
## , , variable = temp
## 
##     month
## day   5  6  7  8  9
##   1  67 78 84 81 91
##   2  72 74 85 81 92
##   3  74 67 81 82 93
##   4  62 84 84 86 93
##   5  56 85 83 85 87
##   6  66 79 83 87 84
##   7  65 82 88 89 80
##   8  59 87 92 90 78
##   9  61 90 92 90 75
##   10 69 87 89 92 73
##   11 74 93 82 86 81
##   12 69 92 73 86 76
##   13 66 82 81 82 77
##   14 68 80 91 80 71
##   15 58 79 80 79 71
##   16 64 77 81 77 78
##   17 66 72 82 79 67
##   18 57 65 84 76 76
##   19 68 73 87 78 68
##   20 62 76 85 78 82
##   21 59 77 74 77 64
##   22 73 76 81 72 71
##   23 61 76 82 75 81
##   24 61 76 86 79 69
##   25 57 75 85 81 63
##   26 58 78 82 86 70
##   27 57 73 86 88 77
##   28 67 80 88 97 75
##   29 81 77 86 94 76
##   30 79 83 83 96 68
##   31 76 NA 81 94 NA
{% endhighlight %}

- margins = grand_row, grand_col 을 넣어서 소계를 만들 수 있다.
- subset = variable == '' 를 설정하여 특정 변수만을 처리할 수 있다.

{% highlight r %}
cast(df_melt,month~variable, fun=mean)
{% endhighlight %}



{% highlight text %}
## Error in fun.aggregate(data$value[0]): 함수 "fun.aggregate"를 찾을 수 없습니다
{% endhighlight %}



{% highlight r %}
cast(df_melt,month~variable, fun = mean, margins = c('grand_row','grand_col')) 
{% endhighlight %}



{% highlight text %}
## Error in fun.aggregate(data$value[0]): 함수 "fun.aggregate"를 찾을 수 없습니다
{% endhighlight %}



{% highlight r %}
cast(df_melt,day~month,mean,subset=variable =='ozone')
{% endhighlight %}



{% highlight text %}
## Error in fun.aggregate(data$value[0]): 함수 "fun.aggregate"를 찾을 수 없습니다
{% endhighlight %}



{% highlight r %}
cast(df_melt, month~variable, min)
{% endhighlight %}



{% highlight text %}
##   month ozone solar.r wind temp
## 1     5     1       8  5.7   56
## 2     6    12      31  1.7   65
## 3     7     7       7  4.1   73
## 4     8     9      24  2.3   72
## 5     9     7      14  2.8   63
{% endhighlight %}

